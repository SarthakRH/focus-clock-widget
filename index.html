<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Focus Clock ‚Äî Hero</title>

<!-- Fonts -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap">

<!-- Firebase (compat for compact code) -->
<script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore-compat.js"></script>

<style>
  :root{
    --accent:#ffffff; --muted:rgba(255,255,255,.82); --soft:rgba(255,255,255,.65);
    --panel:rgba(12,14,18,.72); --panelBorder:rgba(255,255,255,.12);
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Arial,sans-serif;color:#fff;background:#0b0e14;overflow:hidden}

  /* BACKGROUND */
  #bgLayer{position:fixed;inset:0;z-index:-2}
  .live-gradient{position:absolute;inset:-15%;filter:blur(40px);background:linear-gradient(120deg,#2b5876,#4e4376,#0f2027);animation:hue 40s linear infinite;opacity:.9}
  @keyframes hue{from{filter:hue-rotate(0deg) blur(40px)}to{filter:hue-rotate(360deg) blur(40px)}}
  #bgImage,#bgVideo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}

  /* TOP BAR */
  .topbar{position:fixed;inset:16px 16px auto 16px;display:flex;justify-content:space-between;align-items:center;gap:12px;color:var(--muted);font-weight:600;z-index:5}
  .top-left,.top-right{display:flex;gap:16px;align-items:center}
  .iconbtn{padding:8px 10px;border:1px solid rgba(255,255,255,.18);border-radius:10px;background:rgba(0,0,0,.25);color:#fff;cursor:pointer;font-weight:600}
  .iconbtn:hover{background:rgba(255,255,255,.15)}
  .crumb{opacity:.85}

  /* HERO */
  .hero{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:18px}
  .tabs-line{width:min(900px,92vw);max-width:900px;position:relative;margin-bottom:12px}
  .tabs-line::before{content:"";position:absolute;left:0;right:0;top:50%;height:1px;background:rgba(255,255,255,.35);transform:translateY(-50%)}
  .focus-tabs{position:relative;display:inline-flex;gap:28px;padding:0 14px}
  .focus-tabs button{appearance:none;background:transparent;border:none;color:var(--soft);font-weight:800;letter-spacing:.18em;text-transform:uppercase;cursor:pointer;padding:6px 8px;font-size:13px}
  .focus-tabs button.active{color:#fff}
  .time{font-size:clamp(48px,16vw,180px);font-weight:800;line-height:1;letter-spacing:.02em;text-shadow:0 10px 40px rgba(0,0,0,.45)}
  .subtitle{margin-top:8px;font-size:clamp(16px,2.5vw,28px);color:#fff;text-shadow:0 8px 30px rgba(0,0,0,.5)}

  .cta{margin-top:20px;padding:12px 26px;border:1.8px solid rgba(255,255,255,.75);color:#fff;background:rgba(255,255,255,.12);border-radius:999px;font-weight:800;letter-spacing:.06em;cursor:pointer;backdrop-filter:blur(6px)}
  .cta:hover{background:rgba(255,255,255,.18)}
  .cta-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center}
  .cta.secondary{border-color:rgba(255,255,255,.55);background:rgba(255,255,255,.08)}
  .cta.secondary:hover{background:rgba(255,255,255,.14)}

  /* Hero streak pill */
  .streak-hero{
    margin-top:10px;font-weight:800;letter-spacing:.08em;text-transform:uppercase;font-size:12px;color:rgba(255,255,255,.95);
    display:inline-flex;align-items:center;gap:6px;padding:6px 12px;background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.25);
    border-radius:999px;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,.25);
  }

  /* BOTTOM */
  .bottom{position:fixed;inset:auto 16px 14px 16px;display:flex;align-items:center;justify-content:space-between;gap:10px;color:var(--muted);z-index:5;flex-wrap:wrap}
  .loc{display:flex;align-items:center;gap:8px;background:rgba(0,0,0,.28);border:1px solid rgba(255,255,255,.15);border-radius:10px;padding:6px 10px}
  .links{display:flex;gap:10px;align-items:center}
  .quickbtn{background:rgba(0,0,0,.28);border:1px solid rgba(255,255,255,.15);color:#fff;padding:6px 10px;border-radius:10px;font-weight:600;cursor:pointer}
  .quickbtn:hover{background:rgba(255,255,255,.15)}
  .quote{text-align:center;max-width:min(920px,90vw);margin-inline:auto;position:fixed;left:50%;transform:translateX(-50%);bottom:56px;font-size:14px;color:#fff;text-shadow:0 6px 24px rgba(0,0,0,.55)}
  .quote .author{opacity:.8;margin-left:6px}

  /* PANELS */
  .panel{position:fixed;right:16px;top:70px;bottom:16px;width:min(720px,92vw);background:var(--panel);border:1px solid var(--panelBorder);
         border-radius:14px;backdrop-filter:blur(16px) saturate(120%);padding:14px;overflow:auto;display:none;z-index:6}
  .panel.active{display:block}
  h2{margin:4px 0 10px 0;font-size:20px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .pill{padding:6px 10px;border:1px solid var(--panelBorder);border-radius:999px;color:var(--muted);font-size:12px}
  input[type="number"],input[type="text"],input[type="url"],textarea{background:rgba(255,255,255,.06);border:1px solid var(--panelBorder);color:#fff;padding:8px 10px;border-radius:10px}
  textarea{width:100%;min-height:120px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{padding:8px 6px;border-bottom:1px solid var(--panelBorder);font-size:13px;text-align:left}
  .notice{font-size:12px;color:var(--soft)}
  .hidden{display:none}
</style>
</head>
<body>
  <!-- BACKGROUND -->
  <div id="bgLayer">
    <div id="liveGradient" class="live-gradient"></div>
    <img id="bgImage" alt="" style="display:none">
    <video id="bgVideo" muted autoplay loop playsinline style="display:none"></video>
  </div>

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="top-left"><span class="crumb">Links</span><span class="crumb">Tabs</span><span class="crumb">Focus</span></div>
    <div class="top-right">
      <span id="tzLabel" class="crumb"></span>

      <!-- Auth toggle -->
      <button class="iconbtn" id="authToggle">üîê Sign in</button>

      <button class="iconbtn" id="openStats">üìà Stats</button>
      <button class="iconbtn" id="openBg">üñºÔ∏è Background</button>
      <button class="iconbtn" id="openSettings">‚öôÔ∏è Settings</button>
      <button class="iconbtn" id="openSync">üîó Notion Sync</button>
    </div>
  </div>

  <!-- HERO -->
  <main class="hero" aria-live="polite">
    <div class="tabs-line">
      <div class="focus-tabs">
        <button id="tabFocus" class="active">FOCUS</button>
        <button id="tabBreak">BREAK</button>
      </div>
    </div>
    <div id="timeText" class="time">25:00</div>
    <div id="subText" class="subtitle">Focus time.</div>

    <!-- Streak on main display -->
    <div class="streak-hero" id="streakHeroWrap">üî• <span id="streakHero">0</span>-day streak</div>

    <!-- Controls -->
    <div class="cta-row">
      <button id="startStop" class="cta">START</button>
      <!-- NEW: Restart button -->
      <button id="restartBtn" class="cta secondary" title="Start a new session now (does not log partial)">‚ü≥ RESTART</button>
    </div>

    <audio id="ding" preload="auto">
      <source src="data:audio/wav;base64,UklGRjQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABY5YWFhYWFhYWFhYQAA" type="audio/wav">
    </audio>
  </main>

  <!-- BOTTOM -->
  <div class="bottom">
    <div class="loc" id="locLabel">Live gradient</div>
    <div class="links">
      <button id="openNotes" class="quickbtn">Notes</button>
      <button id="openTodos" class="quickbtn">Todo</button>
      <button id="exportBtn" class="quickbtn">Export JSON</button>
      <input id="importFile" type="file" accept="application/json" class="hidden">
      <button id="importBtn" class="quickbtn">Import‚Ä¶</button>
      <button id="resetData" class="quickbtn">Reset</button>
    </div>
  </div>
  <div class="quote" id="quoteBox">‚ÄúSmall progress is still progress.‚Äù <span class="author">‚Äî Unknown</span></div>

  <!-- PANELS -->
  <section id="panel-stats" class="panel">
    <h2>Progress</h2>
    <div class="row" style="margin-bottom:8px;">
      <span class="pill">Goal <span id="goalPill">25</span>m</span>
      <span class="pill">Streak <span id="streakPill">0</span>üî•</span>
      <span class="pill">Free days <span id="freePill">0</span>üéüÔ∏è</span>
      <span class="pill">Next free in <span id="nextFreeIn">14d</span></span>
    </div>
    <canvas id="chart" height="170"></canvas>
    <table id="logTable"><thead><tr><th>Date</th><th>Minutes</th><th>Met goal?</th><th>Used free day?</th></tr></thead><tbody></tbody></table>
    <div class="notice">If the chart is blank, that‚Äôs fine‚ÄîChart.js isn‚Äôt required for the timer to work.</div>
  </section>

  <section id="panel-bg" class="panel">
    <h2>Background</h2>
    <div class="row" style="margin-bottom:8px;">
      <button class="iconbtn" data-bg="gradient">Live gradient</button>
      <button class="iconbtn" data-bg="image">Image‚Ä¶</button>
      <button class="iconbtn" data-bg="video">Video URL‚Ä¶</button>
      <button class="iconbtn" data-bg="color">Solid color‚Ä¶</button>
      <button class="iconbtn" id="bgClear">Reset</button>
    </div>
    <div class="notice">Tip: add <code>&transparent=1</code> in the URL for transparent background in Notion (when embedded via iframe).</div>
  </section>

  <section id="panel-settings" class="panel">
    <h2>Settings</h2>
    <div class="row">
      <div><div class="notice">Session (min)</div><input id="sessionInput" type="number" min="1" max="300" value="25" style="width:120px"></div>
      <div><div class="notice">Daily goal (min)</div><input id="goalInput" type="number" min="10" max="600" value="25" style="width:120px"></div>
    </div>
    <h3 style="margin:10px 0 6px;">Break policy</h3>
    <div class="row">
      <label class="pill"><input type="radio" name="breakPolicy" value="always"> Always break</label>
      <label class="pill"><input type="radio" name="breakPolicy" value="long-only" checked> Only if session &gt; threshold</label>
      <label class="pill"><input type="radio" name="breakPolicy" value="never"> Never break</label>
    </div>
    <div class="row" style="margin-top:6px;">
      <div><div class="notice">Threshold (min)</div><input id="breakThresholdInput" type="number" min="1" max="300" value="30" style="width:120px"></div>
      <div><div class="notice">Break length (min)</div><input id="breakLenInput" type="number" min="0" max="120" value="5" style="width:120px"></div>
    </div>

    <h3 style="margin:12px 0 6px;">Free-day automation</h3>
    <label class="pill"><input type="checkbox" id="autoApplyChk"> Auto-apply free days to recent misses</label>
    <div class="row" style="margin-top:8px;">
      <button id="applyFreeYesterday" class="iconbtn">Apply for yesterday</button>
      <button id="manageMisses" class="iconbtn">Manage missed days‚Ä¶</button>
    </div>

    <h3 style="margin:12px 0 6px;">Notes & Todo (saved locally)</h3>
    <textarea id="notesBox" placeholder="Quick notes‚Ä¶"></textarea>
    <textarea id="todoBox" placeholder="Todo list (one per line)‚Ä¶"></textarea>
  </section>

  <section id="panel-sync" class="panel">
    <h2>Notion Sync (optional)</h2>
    <div class="row">
      <input id="syncEndpoint" placeholder="https://your-app.vercel.app/api/notion-sync" style="flex:1;min-width:240px">
      <input id="syncDb" placeholder="Notion Database ID" style="flex:1;min-width:200px">
      <input id="syncKey" placeholder="Widget key (optional)" style="flex:1;min-width:160px">
    </div>
    <div class="row" style="margin-top:8px;">
      <label class="pill"><input type="checkbox" id="syncEnable"> Enable sync</label>
      <button id="syncNow" class="iconbtn">Sync now</button>
    </div>
    <div class="notice">Sends daily totals (date, minutes, goal, usedFreeDay) to your endpoint. Keep your Notion token server-side.</div>
  </section>

<script>
/* ===== Notion-friendly flags ===== */
var Q = new URLSearchParams(location.search)
